# CWM-A/G/E Schema and Lifecycle Specification

## 1. Overview

Project LOGOS employs a multi-layer Causal World Model (CWM) to reason about the world. These layers are distinct in their abstraction level and source of truth but share a common structural envelope for interoperability.

*   **CWM-A (Abstract)**: The canonical "commonsense" graph. Contains symbolic entities, concepts, and causal rules. It is the source of truth for planning and logical reasoning.
*   **CWM-G (Grounded)**: The "imagination" and "perception" layer. Contains raw sensor data (frames), predicted future states (simulations), and grounded physics properties. It anchors abstract symbols to continuous reality.
*   **CWM-E (Emotional/Reflective)**: The "persona" layer. Contains diary entries, emotional tags, and reflective summaries. It provides the agent with a sense of self, confidence, and social context.

All three layers emit states wrapped in a unified `CWMState` envelope, ensuring that downstream consumers (Apollo, loggers, debuggers) can visualize and process them uniformly.

## 2. Unified Envelope: `CWMState`

Every state emission from Sophia, whether it's a retrieved fact (CWM-A), a JEPA prediction (CWM-G), or a diary entry (CWM-E), conforms to this envelope.

```json
{
  "state_id": "uuid-v4",
  "model_type": "cwm-a" | "cwm-g" | "cwm-e",
  "timestamp": "ISO-8601",
  "status": "hypothetical" | "observed" | "validated" | "rejected",
  "confidence": 0.0 - 1.0,
  "source": "planner" | "jepa" | "perception" | "reflection",
  "links": [
    { "rel": "derived_from", "target_id": "uuid-of-parent-state" },
    { "rel": "predicts", "target_id": "uuid-of-future-state" }
  ],
  "data": {
    // Model-specific payload (see below)
  }
}
```

### Status Lifecycle
*   **hypothetical**: Generated by a planner or simulator (CWM-G/A). Not yet verified against reality.
*   **observed**: Directly perceived from sensors (CWM-G).
*   **validated**: Confirmed by SHACL constraints or consensus (promoted to CWM-A).
*   **rejected**: Falsified by observation or validation failure.

## 3. Schemas by Model Type

### 3.1 CWM-A (Abstract)
**Focus**: Symbolic reasoning, planning, ontology.
**Storage**: Neo4j (Graph) + Milvus (Semantic).

**Key Node Types**:
*   `Entity`: Physical objects or agents.
*   `Concept`: Abstract categories (e.g., `Cup`, `Grasp`).
*   `State`: Snapshots of entity properties at a time.
*   `Process`: Causal transitions (`State A -[CAUSES]-> State B`).

**Payload (`data` field)**:
```json
{
  "concept_id": "uuid-concept-container",
  "name": "Container",
  "definition": "Object capable of holding other objects",
  "affordances": ["containment", "support"],
  "relations": [
    { "type": "IS_A", "target": "PhysicalObject" }
  ]
}
```

### 3.2 CWM-G (Grounded)
**Focus**: Perception, simulation, physics grounding.
**Storage**: Ephemeral (Redis/Memory) -> Promoted to Neo4j for significant events.

**Key Node Types**:
*   `PerceptionFrame`: Raw input from Talos (sensors) or Hermes (language/audio/uploads).
*   `ImaginedState`: A predicted future state from the JEPA/Simulator.
*   `ImaginedProcess`: The action applied to reach an imagined state.

**Payload (`data` field)**:
```json
{
  "frame_id": "uuid",
  "modality": "vision" | "proprioception",
  "blob_ref": "s3://bucket/frame_123.jpg",
  "embedding": [0.1, 0.5, ...], // JEPA latent vector
  "physics_props": {
    "mass": 1.2,
    "friction": 0.5
  }
}
```

### 3.3 CWM-E (Emotional)
**Focus**: Reflection, persona, confidence.
**Storage**: Neo4j (Persona Subgraph).

**Key Node Types**:
*   `PersonaEntry`: A diary entry or narrative summary.
*   `EmotionState`: Affective tags attached to other nodes.

**Payload (`data` field)**:
```json
{
  "sentiment": "cautious",
  "intensity": 0.8,
  "summary": "I am unsure if the grip is stable.",
  "context_ref": "uuid-of-process-being-reflected-on"
}
```

## 4. Ingestion and Promotion Flows

### 4.1 Perception Loop (CWM-G -> CWM-A)
1.  **Ingest**: Talos or Hermes sends raw sensor/input data. Sophia wraps it in `CWMState` (CWM-G, status=`observed`).
2.  **Ground**: JEPA/Encoders convert raw data to latent embeddings.
3.  **Classify**: Embeddings are matched against CWM-A Concepts in Milvus.
4.  **Promote**: If a match is found with high confidence, a `State` node is created/updated in CWM-A (status=`validated`).

### 4.2 Imagination Loop (CWM-A -> CWM-G -> CWM-A)
1.  **Hypothesize**: Planner proposes an action (CWM-A, status=`hypothetical`).
2.  **Simulate**: Sophia calls `simulate()` with the action.
3.  **Predict**: Simulator/JEPA returns `ImaginedState` (CWM-G, status=`hypothetical`).
4.  **Validate**: SHACL checks if the imagined state violates constraints (e.g., collision).
5.  **Commit**: If valid, the plan is approved for execution.

### 4.3 Reflection Loop (CWM-A/G -> CWM-E)
1.  **Monitor**: The "Inner Monologue" service watches the event stream.
2.  **Reflect**: Significant events (failures, success, high uncertainty) trigger a reflection.
3.  **Annotate**: A `PersonaEntry` is created (CWM-E) linking to the event.
4.  **Adjust**: Emotional state (e.g., `confidence`) is updated, influencing future planner heuristics.

## 5. API & SDK

All interactions occur via the unified endpoints in Sophia:

*   `GET /state?model_type=cwm-a`: Retrieve current abstract world state.
*   `POST /simulate`: Submit a state/action to CWM-G for prediction.
*   `GET /history?include_emotions=true`: Retrieve execution history with interleaved CWM-E entries.

The SDK provides typed wrappers:
*   `logos.cwm.AbstractState`
*   `logos.cwm.GenerativeState`
*   `logos.cwm.EmotionalState`

All inheriting from the base `CWMState` class.
